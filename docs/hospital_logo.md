# توثيق وظيفة صورة المستشفى

## نظرة عامة

تم إضافة وظيفة تحميل وعرض صورة (شعار) للمستشفى في النظام. يمكن للمستخدم تحميل صورة للمستشفى عند إنشاء مستشفى جديد أو تعديل مستشفى موجود.

## الوظائف المدعومة

1. **تحميل صورة للمستشفى**:
   - يمكن للمستخدم تحميل صورة للمستشفى عند إنشاء مستشفى جديد.
   - يمكن للمستخدم تعديل صورة المستشفى عند تعديل مستشفى موجود.

2. **عرض صورة المستشفى**:
   - يتم عرض صورة المستشفى في صفحة تفاصيل المستشفى.
   - يتم عرض صورة المستشفى في قائمة المستشفيات.

3. **حذف صورة المستشفى**:
   - عند حذف المستشفى، يتم حذف صورة المستشفى تلقائيًا.

## آلية العمل

1. **تحميل الصورة**:
   - يتم تحميل الصورة باستخدام حقل FileField في نموذج المستشفى.
   - يتم التحقق من نوع الملف وحجمه قبل تحميله.

2. **عرض الصورة**:
   - يتم عرض الصورة في صفحة تفاصيل المستشفى وقائمة المستشفيات.

3. **حذف الصورة**:
   - عند حذف المستشفى، يتم حذف الصورة تلقائيًا باستخدام دالة delete() المخصصة.

## التنفيذ التقني

تم تنفيذ وظيفة صورة المستشفى من خلال:

1. **إضافة حقل logo في نموذج المستشفى**:
   - تم إضافة حقل logo من نوع ImageField في نموذج المستشفى.

2. **تعديل النافذة المنبثقة للمستشفى**:
   - تم تعديل النافذة المنبثقة لإضافة مستشفى جديد لتضمين حقل تحميل الصورة.

3. **تعديل وظيفة AJAX لإنشاء المستشفى**:
   - تم تعديل وظيفة hospital_create_ajax للتعامل مع تحميل الصورة.

4. **تعديل ملف JavaScript للنوافذ المنبثقة**:
   - تم تعديل ملف modal_forms.js للتعامل مع تحميل الصورة.

## مثال على الكود

```python
# نموذج المستشفى
class Hospital(models.Model):
    # ... حقول أخرى ...
    logo = models.ImageField(upload_to='hospital_logos/', blank=True, null=True, verbose_name='شعار المستشفى')

    def delete(self, *args, **kwargs):
        """حذف المستشفى وملف الشعار المرتبط به"""
        # حذف ملف الشعار إذا كان موجودًا
        if self.logo:
            if self.logo.storage.exists(self.logo.name):
                self.logo.delete()

        # حذف المستشفى
        super().delete(*args, **kwargs)
```

```javascript
// نموذج المستشفى
$('#hospital-form').on('submit', function(e) {
    e.preventDefault();

    // إنشاء كائن FormData للتعامل مع الملفات
    var formData = new FormData(this);

    $.ajax({
        url: '/hospitals/create-ajax/',
        type: 'POST',
        data: formData,
        processData: false, // مهم للتعامل مع الملفات
        contentType: false, // مهم للتعامل مع الملفات
        dataType: 'json',
        success: function(response) {
            // ... معالجة الاستجابة ...
        },
        error: function(xhr, status, error) {
            // ... معالجة الخطأ ...
        }
    });
});
```

## الاستخدام

1. **إضافة صورة للمستشفى**:
   - عند إنشاء مستشفى جديد، يمكن للمستخدم تحميل صورة للمستشفى.
   - يجب أن تكون الصورة بتنسيق PNG أو JPG أو JPEG أو GIF.
   - يجب أن يكون حجم الصورة أقل من 2 ميجابايت.

2. **تعديل صورة المستشفى**:
   - عند تعديل مستشفى موجود، يمكن للمستخدم تعديل صورة المستشفى.

## ملاحظات

1. **أنواع الملفات المدعومة**:
   - يتم دعم أنواع الملفات التالية: PNG، JPG، JPEG، GIF.

2. **حجم الملف**:
   - يجب أن يكون حجم الملف أقل من 2 ميجابايت.

3. **مجلد التخزين**:
   - يتم تخزين الصور في مجلد 'hospital_logos/' داخل مجلد الوسائط.
