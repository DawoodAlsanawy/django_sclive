# واجهات برمجة التطبيقات (APIs)

يوفر النظام مجموعة من واجهات برمجة التطبيقات (APIs) التي تسمح بالتفاعل مع البيانات بشكل برمجي. فيما يلي شرح تفصيلي لكل واجهة:

## واجهات البحث

### doctor_search_api

```
GET /doctors/api/search/?q=<query>
```

هذه الواجهة تسمح بالبحث عن الأطباء بناءً على الاسم أو رقم الهوية.

#### المعلمات

- **q**: نص البحث (مطلوب)

#### الاستجابة

تعيد قائمة من الأطباء المطابقين لنص البحث بتنسيق JSON:

```json
[
  {
    "id": 1,
    "display": "د. أحمد محمد",
    "national_id": "1234567890",
    "position": "طبيب عام",
    "hospital": "مستشفى الملك فهد"
  },
  ...
]
```

### patient_search_api

```
GET /patients/api/search/?q=<query>
```

هذه الواجهة تسمح بالبحث عن المرضى بناءً على الاسم أو رقم الهوية.

#### المعلمات

- **q**: نص البحث (مطلوب)

#### الاستجابة

تعيد قائمة من المرضى المطابقين لنص البحث بتنسيق JSON:

```json
[
  {
    "id": 1,
    "text": "محمد أحمد (1234567890)",
    "display": "محمد أحمد",
    "national_id": "1234567890",
    "nationality": "سعودي",
    "employer": "شركة الاتصالات السعودية"
  },
  ...
]
```

### client_search_api

```
GET /clients/api/search/?q=<query>
```

هذه الواجهة تسمح بالبحث عن العملاء بناءً على الاسم أو رقم الهاتف.

#### المعلمات

- **q**: نص البحث (مطلوب)

#### الاستجابة

تعيد قائمة من العملاء المطابقين لنص البحث بتنسيق JSON:

```json
[
  {
    "id": 1,
    "text": "شركة الاتصالات السعودية",
    "display": "شركة الاتصالات السعودية",
    "phone": "0512345678",
    "email": "info@stc.com.sa",
    "balance": 1500.00
  },
  ...
]
```

### sick_leave_search_api

```
GET /sick-leaves/api/search/?q=<query>
```

هذه الواجهة تسمح بالبحث عن الإجازات المرضية بناءً على رقم الإجازة أو اسم المريض.

#### المعلمات

- **q**: نص البحث (مطلوب)

#### الاستجابة

تعيد قائمة من الإجازات المرضية المطابقة لنص البحث بتنسيق JSON:

```json
[
  {
    "id": 1,
    "leave_id": "SL-2023-001",
    "patient_name": "محمد أحمد",
    "doctor_name": "د. أحمد محمد",
    "start_date": "2023-01-01",
    "end_date": "2023-01-07",
    "duration_days": 7,
    "status": "active"
  },
  ...
]
```

### companion_leave_search_api

```
GET /companion-leaves/api/search/?q=<query>
```

هذه الواجهة تسمح بالبحث عن إجازات المرافقين بناءً على رقم الإجازة أو اسم المريض أو اسم المرافق.

#### المعلمات

- **q**: نص البحث (مطلوب)

#### الاستجابة

تعيد قائمة من إجازات المرافقين المطابقة لنص البحث بتنسيق JSON:

```json
[
  {
    "id": 1,
    "leave_id": "CL-2023-001",
    "patient_name": "محمد أحمد",
    "companion_name": "علي محمد",
    "doctor_name": "د. أحمد محمد",
    "start_date": "2023-01-01",
    "end_date": "2023-01-07",
    "duration_days": 7,
    "status": "active"
  },
  ...
]
```

## واجهات الأسعار

### leave_price_api_get_price

```
GET /leave-prices/api/get-price/?leave_type=<leave_type>&duration_days=<duration_days>
```

هذه الواجهة تسمح بالحصول على سعر الإجازة بناءً على نوع الإجازة ومدتها.

#### المعلمات

- **leave_type**: نوع الإجازة (sick_leave أو companion_leave) (مطلوب)
- **duration_days**: مدة الإجازة بالأيام (مطلوب)

#### الاستجابة

تعيد سعر الإجازة بتنسيق JSON:

```json
{
  "price": 1500.00
}
```

## ملاحظات هامة

### المصادقة

جميع واجهات برمجة التطبيقات تتطلب مصادقة المستخدم. يجب أن يكون المستخدم مسجل الدخول لاستخدام هذه الواجهات.

### تنسيق الاستجابة

جميع الاستجابات تكون بتنسيق JSON.

### رموز الحالة

- **200 OK**: تم تنفيذ الطلب بنجاح.
- **400 Bad Request**: الطلب غير صحيح أو ينقصه معلمات مطلوبة.
- **401 Unauthorized**: المستخدم غير مصادق.
- **403 Forbidden**: المستخدم ليس لديه صلاحية للوصول إلى الواجهة.
- **404 Not Found**: المورد المطلوب غير موجود.
- **500 Internal Server Error**: حدث خطأ في الخادم.

### حدود الاستعلام

بعض واجهات البحث تحد من عدد النتائج المعادة لتحسين الأداء. على سبيل المثال، واجهة `doctor_search_api` تعيد فقط أول 10 نتائج مطابقة.

### استخدام الواجهات في واجهة المستخدم

تستخدم هذه الواجهات في واجهة المستخدم لتوفير وظائف البحث والاختيار في النماذج. على سبيل المثال، عند إنشاء إجازة مرضية، يمكن للمستخدم البحث عن المريض والطبيب باستخدام هذه الواجهات.
