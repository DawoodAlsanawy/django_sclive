# توثيق وظيفة التواريخ الهجرية

## نظرة عامة

تم إضافة وظيفة التواريخ الهجرية في النظام، حيث يتم تحويل التواريخ الميلادية إلى تواريخ هجرية تلقائيًا وعرضها في قوالب الطباعة والعرض.

## الوظائف المدعومة

1. **تحويل التواريخ الميلادية إلى هجرية**:
   - عند إنشاء إجازة مرضية أو إجازة مرافق، يتم تحويل تاريخ البداية وتاريخ النهاية إلى التاريخ الهجري المقابل.

2. **عرض التواريخ الهجرية في قوالب الطباعة**:
   - تم تعديل قوالب الطباعة (PSL و GSL وقالب إجازة المرافق) لعرض التواريخ الهجرية.

3. **عرض التواريخ الهجرية في صفحات العرض**:
   - تم تعديل صفحات عرض الإجازات المرضية وإجازات المرافقين لعرض التواريخ الهجرية.

## آلية العمل

1. **تحويل التواريخ عند الإنشاء**:
   - عند إنشاء إجازة مرضية أو إجازة مرافق، يتم استخدام مكتبة hijri-converter لتحويل التواريخ الميلادية إلى تواريخ هجرية.
   - يتم تخزين التواريخ الهجرية في حقول منفصلة في قاعدة البيانات.

2. **عرض التواريخ في القوالب**:
   - تم تعديل قوالب الطباعة لعرض التواريخ الهجرية في الأماكن المناسبة.
   - تم تعديل صفحات العرض لعرض التواريخ الهجرية إلى جانب التواريخ الميلادية.

## التنفيذ التقني

تم تنفيذ وظيفة التواريخ الهجرية من خلال:

1. **استخدام مكتبة hijri-converter**:
   - تم استخدام مكتبة hijri-converter لتحويل التواريخ الميلادية إلى تواريخ هجرية.

2. **تعديل نماذج الإجازات**:
   - تم تعديل نماذج SickLeave و CompanionLeave لإضافة حقول التواريخ الهجرية.
   - تم تعديل دالة save() في هذه النماذج لتحويل التواريخ الميلادية إلى تواريخ هجرية تلقائيًا.

3. **تعديل قوالب الطباعة**:
   - تم تعديل قوالب الطباعة لعرض التواريخ الهجرية في الأماكن المناسبة.

## مثال على الكود

```python
def save(self, *args, **kwargs):
    """حفظ الإجازة المرضية مع تحويل التواريخ إلى هجرية"""
    # تحويل تاريخ البداية إلى هجري
    if self.start_date and not self.start_date_hijri:
        try:
            from hijri_converter import convert
            hijri_date = convert.Gregorian(
                self.start_date.year,
                self.start_date.month,
                self.start_date.day
            ).to_hijri()
            self.start_date_hijri = f"{hijri_date.day}/{hijri_date.month}/{hijri_date.year}"
        except Exception:
            pass

    # ... المزيد من التحويلات ...

    super().save(*args, **kwargs)
```

## الاستخدام

لا يحتاج المستخدم إلى القيام بأي إجراء إضافي لاستخدام وظيفة التواريخ الهجرية. عند إنشاء إجازة مرضية أو إجازة مرافق، سيتم تحويل التواريخ الميلادية إلى تواريخ هجرية تلقائيًا وعرضها في قوالب الطباعة والعرض.

## ملاحظات

1. **دقة التحويل**:
   - يعتمد تحويل التواريخ على مكتبة hijri-converter، والتي توفر تحويلًا دقيقًا للتواريخ.
   - قد تكون هناك اختلافات طفيفة في بعض الحالات بسبب اختلاف طرق حساب التقويم الهجري.

2. **تنسيق التواريخ**:
   - يتم تخزين التواريخ الهجرية بتنسيق "يوم/شهر/سنة" (مثل "15/7/1445").
   - يمكن تعديل هذا التنسيق حسب الحاجة.
