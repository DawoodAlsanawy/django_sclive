{% extends 'base.html' %}
{% load static %}

{% block title %}إعدادات الشركة{% endblock %}

{% block extra_css %}
<style>
.settings-form {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.form-section {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #dee2e6;
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.form-section h5 {
    color: #495057;
    margin-bottom: 1rem;
    font-weight: 600;
}

.company-preview {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.company-logo-preview {
    width: 100px;
    height: 100px;
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    margin-bottom: 1rem;
}

.company-logo-preview img {
    max-width: 90px;
    max-height: 90px;
    object-fit: contain;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="page-title">
                        <i class="fas fa-building me-2"></i>
                        إعدادات الشركة
                    </h1>
                    <p class="text-muted">معلومات الشركة والعيادة والشعار</p>
                </div>
                <a href="{% url 'settings:index' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-right me-1"></i>
                    العودة للإعدادات
                </a>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <form method="post" enctype="multipart/form-data" class="settings-form">
                        {% csrf_token %}
                        
                        <div class="form-section">
                            <h5>
                                <i class="fas fa-info-circle me-2"></i>
                                المعلومات الأساسية
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.company_name.id_for_label }}" class="form-label">
                                            {{ form.company_name.label }}
                                        </label>
                                        {{ form.company_name }}
                                        {% if form.company_name.errors %}
                                            <div class="text-danger small">{{ form.company_name.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.license_number.id_for_label }}" class="form-label">
                                            {{ form.license_number.label }}
                                        </label>
                                        {{ form.license_number }}
                                        {% if form.license_number.errors %}
                                            <div class="text-danger small">{{ form.license_number.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.company_address.id_for_label }}" class="form-label">
                                    {{ form.company_address.label }}
                                </label>
                                {{ form.company_address }}
                                {% if form.company_address.errors %}
                                    <div class="text-danger small">{{ form.company_address.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>
                                <i class="fas fa-phone me-2"></i>
                                معلومات الاتصال
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.company_phone.id_for_label }}" class="form-label">
                                            {{ form.company_phone.label }}
                                        </label>
                                        {{ form.company_phone }}
                                        {% if form.company_phone.errors %}
                                            <div class="text-danger small">{{ form.company_phone.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.company_email.id_for_label }}" class="form-label">
                                            {{ form.company_email.label }}
                                        </label>
                                        {{ form.company_email }}
                                        {% if form.company_email.errors %}
                                            <div class="text-danger small">{{ form.company_email.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.company_website.id_for_label }}" class="form-label">
                                    {{ form.company_website.label }}
                                </label>
                                {{ form.company_website }}
                                {% if form.company_website.errors %}
                                    <div class="text-danger small">{{ form.company_website.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>
                                حفظ الإعدادات
                            </button>
                            <button type="reset" class="btn btn-outline-secondary">
                                <i class="fas fa-undo me-1"></i>
                                إعادة تعيين
                            </button>
                        </div>
                    </form>
                </div>

                <div class="col-lg-4">
                    <div class="company-preview">
                        <h6 class="mb-3">
                            <i class="fas fa-eye me-1"></i>
                            معاينة بيانات الشركة
                        </h6>
                        
                        <div class="company-logo-preview">
                            <i class="fas fa-building fa-2x text-muted"></i>
                        </div>
                        
                        <div id="company-preview-content">
                            <h6 id="preview-name" class="text-primary">اسم الشركة</h6>
                            <p id="preview-address" class="text-muted small mb-2">عنوان الشركة</p>
                            <p id="preview-phone" class="small mb-1">
                                <i class="fas fa-phone me-1"></i>
                                <span>رقم الهاتف</span>
                            </p>
                            <p id="preview-email" class="small mb-1">
                                <i class="fas fa-envelope me-1"></i>
                                <span>البريد الإلكتروني</span>
                            </p>
                            <p id="preview-website" class="small mb-0">
                                <i class="fas fa-globe me-1"></i>
                                <span>الموقع الإلكتروني</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // تحديث المعاينة عند تغيير البيانات
    function updatePreview() {
        const name = $('#{{ form.company_name.id_for_label }}').val() || 'اسم الشركة';
        const address = $('#{{ form.company_address.id_for_label }}').val() || 'عنوان الشركة';
        const phone = $('#{{ form.company_phone.id_for_label }}').val() || 'رقم الهاتف';
        const email = $('#{{ form.company_email.id_for_label }}').val() || 'البريد الإلكتروني';
        const website = $('#{{ form.company_website.id_for_label }}').val() || 'الموقع الإلكتروني';

        $('#preview-name').text(name);
        $('#preview-address').text(address);
        $('#preview-phone span').text(phone);
        $('#preview-email span').text(email);
        $('#preview-website span').text(website);
    }

    // ربط الأحداث
    $('#{{ form.company_name.id_for_label }}, #{{ form.company_address.id_for_label }}, #{{ form.company_phone.id_for_label }}, #{{ form.company_email.id_for_label }}, #{{ form.company_website.id_for_label }}').on('input', updatePreview);

    // تحديث المعاينة عند تحميل الصفحة
    updatePreview();

    // تأكيد إعادة التعيين
    $('button[type="reset"]').click(function(e) {
        if (!confirm('هل أنت متأكد من إعادة تعيين جميع الحقول؟')) {
            e.preventDefault();
        } else {
            setTimeout(updatePreview, 100);
        }
    });
});
</script>
{% endblock %}
