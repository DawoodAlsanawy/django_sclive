{% extends 'base.html' %}

{% block title %}الصفحة الرئيسية - نظام إدارة الإجازات المرضية{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2>لوحة التحكم</h2>
        <p class="text-muted">مرحباً بك في نظام إدارة الإجازات المرضية</p>
    </div>
</div>

<!-- إحصائيات عامة -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">الإجازات المرضية</h5>
                        <h2 class="mb-0">{{ stats.sick_leaves_count }}</h2>
                    </div>
                    <i class="fas fa-procedures fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">إجازات المرافقين</h5>
                        <h2 class="mb-0">{{ stats.companion_leaves_count }}</h2>
                    </div>
                    <i class="fas fa-user-nurse fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">الفواتير</h5>
                        <h2 class="mb-0">{{ stats.invoices_count }}</h2>
                    </div>
                    <i class="fas fa-file-invoice-dollar fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">المدفوعات</h5>
                        <h2 class="mb-0">{{ stats.payments_count }}</h2>
                    </div>
                    <i class="fas fa-money-bill-wave fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- إحصائيات مالية -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card text-white bg-dark">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">إجمالي الفواتير</h5>
                        <h2 class="mb-0">{{ stats.total_invoices_amount|floatformat:2 }} ريال</h2>
                    </div>
                    <i class="fas fa-file-invoice fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card text-white bg-dark">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">إجمالي المدفوعات</h5>
                        <h2 class="mb-0">{{ stats.total_payments_amount|floatformat:2 }} ريال</h2>
                    </div>
                    <i class="fas fa-hand-holding-usd fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card text-white {% if stats.total_balance > 0 %}bg-danger{% else %}bg-success{% endif %}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">الرصيد المتبقي</h5>
                        <h2 class="mb-0">{{ stats.total_balance|floatformat:2 }} ريال</h2>
                    </div>
                    <i class="fas fa-balance-scale fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- إحصائيات إضافية -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card text-white bg-secondary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">الأطباء</h5>
                        <h2 class="mb-0">{{ stats.doctors_count }}</h2>
                    </div>
                    <i class="fas fa-user-md fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card text-white bg-secondary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">المرضى</h5>
                        <h2 class="mb-0">{{ stats.patients_count }}</h2>
                    </div>
                    <i class="fas fa-user-injured fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-3">
        <div class="card text-white bg-secondary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">العملاء</h5>
                        <h2 class="mb-0">{{ stats.clients_count }}</h2>
                    </div>
                    <i class="fas fa-users fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

{% if request.user.is_doctor and stats.doctor_sick_leaves_count is not None %}
<!-- إحصائيات خاصة بالطبيب -->
<div class="row mb-4">
    <div class="col-12">
        <h4>إحصائيات خاصة بك</h4>
    </div>
    <div class="col-md-6 mb-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">الإجازات المرضية الخاصة بك</h5>
                        <h2 class="mb-0">{{ stats.doctor_sick_leaves_count }}</h2>
                    </div>
                    <i class="fas fa-procedures fa-3x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title">إجازات المرافقين الخاصة بك</h5>
                        <h2 class="mb-0">{{ stats.doctor_companion_leaves_count }}</h2>
                    </div>
                    <i class="fas fa-user-nurse fa-3x"></i>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <!-- آخر الإجازات المرضية -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">آخر الإجازات المرضية</h5>
                <a href="{% url 'core:sick_leave_list' %}" class="btn btn-sm btn-primary">عرض الكل</a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>رقم الإجازة</th>
                                <th>المريض</th>
                                <th>تاريخ البداية</th>
                                <th>تاريخ النهاية</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for leave in recent_sick_leaves %}
                            <tr>
                                <td>{{ leave.leave_id }}</td>
                                <td>{{ leave.patient.name }}</td>
                                <td>{{ leave.start_date }}</td>
                                <td>{{ leave.end_date }}</td>
                                <td>
                                    {% if leave.status == 'active' %}
                                    <span class="badge bg-success">نشطة</span>
                                    {% elif leave.status == 'cancelled' %}
                                    <span class="badge bg-danger">ملغية</span>
                                    {% elif leave.status == 'expired' %}
                                    <span class="badge bg-secondary">منتهية</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">لا توجد إجازات مرضية</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- آخر إجازات المرافقين -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">آخر إجازات المرافقين</h5>
                <a href="{% url 'core:companion_leave_list' %}" class="btn btn-sm btn-primary">عرض الكل</a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>رقم الإجازة</th>
                                <th>المريض</th>
                                <th>المرافق</th>
                                <th>تاريخ البداية</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for leave in recent_companion_leaves %}
                            <tr>
                                <td>{{ leave.leave_id }}</td>
                                <td>{{ leave.patient.name }}</td>
                                <td>{{ leave.companion.name }}</td>
                                <td>{{ leave.start_date }}</td>
                                <td>
                                    {% if leave.status == 'active' %}
                                    <span class="badge bg-success">نشطة</span>
                                    {% elif leave.status == 'cancelled' %}
                                    <span class="badge bg-danger">ملغية</span>
                                    {% elif leave.status == 'expired' %}
                                    <span class="badge bg-secondary">منتهية</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">لا توجد إجازات مرافقين</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- آخر الفواتير -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">آخر الفواتير</h5>
                <a href="{% url 'core:leave_invoice_list' %}" class="btn btn-sm btn-primary">عرض الكل</a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>العميل</th>
                                <th>المبلغ</th>
                                <th>تاريخ الإصدار</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for invoice in recent_invoices %}
                            <tr>
                                <td>{{ invoice.invoice_number }}</td>
                                <td>{{ invoice.client.name }}</td>
                                <td>{{ invoice.amount }} ريال</td>
                                <td>{{ invoice.issue_date }}</td>
                                <td>
                                    {% if invoice.status == 'unpaid' %}
                                    <span class="badge bg-danger">غير مدفوعة</span>
                                    {% elif invoice.status == 'partially_paid' %}
                                    <span class="badge bg-warning">مدفوعة جزئيًا</span>
                                    {% elif invoice.status == 'paid' %}
                                    <span class="badge bg-success">مدفوعة بالكامل</span>
                                    {% elif invoice.status == 'cancelled' %}
                                    <span class="badge bg-secondary">ملغية</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">لا توجد فواتير</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- آخر المدفوعات -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">آخر المدفوعات</h5>
                <a href="{% url 'core:payment_list' %}" class="btn btn-sm btn-primary">عرض الكل</a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>رقم الدفعة</th>
                                <th>العميل</th>
                                <th>المبلغ</th>
                                <th>تاريخ الدفع</th>
                                <th>طريقة الدفع</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in recent_payments %}
                            <tr>
                                <td>{{ payment.payment_number }}</td>
                                <td>{{ payment.client.name }}</td>
                                <td>{{ payment.amount }} ريال</td>
                                <td>{{ payment.payment_date }}</td>
                                <td>
                                    {% if payment.payment_method == 'cash' %}
                                    <span class="badge bg-success">نقدًا</span>
                                    {% elif payment.payment_method == 'bank_transfer' %}
                                    <span class="badge bg-primary">تحويل بنكي</span>
                                    {% elif payment.payment_method == 'check' %}
                                    <span class="badge bg-info">شيك</span>
                                    {% elif payment.payment_method == 'credit_card' %}
                                    <span class="badge bg-warning">بطاقة ائتمان</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">لا توجد مدفوعات</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
